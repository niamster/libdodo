
prefix:=@prefix@
exec_prefix:=@exec_prefix@
mandir:=@mandir@
LIBDIR:=@libdir@
INCLUDEDIR:=@includedir@

CXX:=@CXX@
INSTALL:=@INSTALL@
LN_S = @LN_S@

CPPFLAGS:=-I./include @CPPFLAGS@
LDFLAGS:= -L./ @LDFLAGS@
LIBS:=@LIBS@
CFLAGS:=@CFLAGS@
DEFINES:=-D_REENTRANT -D_GNU_SOURCE -D__USE_UNIX98 -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64 @DEFS@

###########################################################

OBJECTS:=dbBase.o \
		tools.o \
		xexec.o \
		dbSqlBase.o \
		baseEx.o \
		dbMysql.o \
		cgiTools.o \
		regexpTools.o \
		flushSocketOptions.o \
		flushSocketExchange.o \
		flushSocketTools.o \
		flushSocket.o \
		flushDiskTools.o \
		flushDisk.o \
		flushSTD.o \
		systemTools.o \
		timeTools.o \
		xmlTools.o \
		dbSqlite.o \
		systemThreads.o \
		systemThreadShares.o \
		dbPostgresql.o \
		cgiPreprocessor.o \
		flush.o \
		dbInterface.o \
		cgiFast.o \
		cgiProcessor.o \
		flushNBA.o

###########################################################

VPATH:=src/

all: @PACKAGE_NAME@

@PACKAGE_NAME@: $(OBJECTS)
	$(CXX) $(CFLAGS) $(LDFLAGS) $(LIBS) -shared -Wl,-soname,$@.so.@PACKAGE_VERSION@ -o $@.so.@PACKAGE_VERSION@ $(OBJECTS)
	strip -d --strip-unneeded @PACKAGE_NAME@.so.@PACKAGE_VERSION@
	ln -sf @PACKAGE_NAME@.so.@PACKAGE_VERSION@ $@.so
	
	ar rc @PACKAGE_NAME@.a.@PACKAGE_VERSION@ $(OBJECTS)
	ln -sf @PACKAGE_NAME@.a.@PACKAGE_VERSION@ $@.a
	
	@echo ""
	@echo ""
	@echo "Now you can run 'gmake install'."

.cc.o:
	$(CXX) $(DEFINES) $(CPPFLAGS) $(CFLAGS) -fPIC -c $^
	strip -d --strip-unneeded $@

install: 
	${INSTALL} -m 644 -d $(LIBDIR)
	${INSTALL} -m 644 @PACKAGE_NAME@.so.@PACKAGE_VERSION@ $(LIBDIR)/
	${INSTALL} -m 644 -d $(INCLUDEDIR)/
	cd include; for i in ./*; do ${INSTALL} -m 644 $$i $(INCLUDEDIR)/; done; cd ..
	
	$(LN_S) -f $(LIBDIR)/@PACKAGE_NAME@.so.@PACKAGE_VERSION@ $(LIBDIR)/@PACKAGE_NAME@.so
	
	@echo ""
	@echo ""
	@echo "Use libdodo with pleasure"
	@echo ""
	@echo ""

uninstall:
	rm -f $(LIBDIR)/@PACKAGE_NAME@.so.@PACKAGE_VERSION@
	rm -f $(LIBDIR)/@PACKAGE_NAME@.so
	rmdir $(LIBDIR)
	
	cd include; for i in ./*; do rm -f $(INCLUDEDIR)/$$i; done; cd ..
	rmdir $(INCLUDEDIR)
	
	rmdir $(prefix)
clean:
	rm -rf *.o *.so* *.a*

force : clean @PACKAGE_NAME@


prefix:=@prefix@
datarootdir:=@datarootdir@
exec_prefix:=@exec_prefix@
mandir:=@mandir@
libdir:=@libdir@
bindir:=@bindir@
includedir:=@includedir@

CXX:=@CXX@
INSTALL:=@INSTALL@
LN_S = @LN_S@

CPPFLAGS:=-I./include @CPPFLAGS@
LDFLAGS:= -L./ @LDFLAGS@ -lrt
CFLAGS:=@CFLAGS@
DEFINES:=-D_REENTRANT -D_GNU_SOURCE -D__USE_UNIX98 -D_XOPEN_SOURCE=600 \
	-D_LARGEFILE64_SOURCE -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64 -D_THREAD_SAFE \
	@DEFS@

###########################################################

OBJECTS:=dataBaseAccumulator.o \
	dataBaseConnector.o \
	dataBaseSqlConstructor.o \
	dataBasePostgresql.o \
	dataBaseMysql.o \
	dataBaseSqlite.o \
	dataFormatJsonProcessor.o \
	dataFormatJsonNode.o \
	dataFormatXmlProcessor.o \
	dataFormatXmlNode.o \
	dataTplProcessor.o \
	dataMemoryShared.o \
	toolsMisc.o \
	toolsCode.o \
	toolsFilesystem.o \
	toolsOs.o \
	toolsTime.o \
	toolsNetwork.o \
	toolsString.o \
	toolsLogger.o \
	toolsLibrary.o \
	toolsRegexp.o \
	types.o \
	xexec.o \
	exceptionBasic.o \
	ioChannel.o \
	ioFileFifo.o \
	ioFileRegular.o \
	ioFileTemp.o \
	ioEvent.o \
	ioEventInfo.o \
	ioStdio.o \
	ioPipe.o \
	ioSsl.o \
	ioNetworkHttp.o \
	ioNetworkConnection.o \
	ioNetworkSslExchange.o \
	ioNetworkSslServer.o \
	ioNetworkSslClient.o \
	ioNetworkExchange.o \
	ioNetworkServer.o \
	ioNetworkClient.o \
	rpcValue.o \
	rpcMethod.o \
	rpcResponse.o \
	rpcClient.o \
	rpcServer.o \
	rpcHttpClient.o \
	rpcCgiServer.o \
	rpcXmlClient.o \
	rpcXmlHttpClient.o \
	rpcXmlServer.o \
	rpcXmlCgiServer.o \
	rpcXmlValue.o \
	rpcXmlMethod.o \
	rpcXmlResponse.o \
	rpcJsonCgiServer.o \
	rpcJsonClient.o \
	rpcJsonHttpClient.o \
	rpcJsonMethod.o \
	rpcJsonResponse.o \
	rpcJsonServer.o \
	rpcJsonValue.o \
	graphicsTransform.o \
	graphicsImage.o \
	graphicsDraw.o \
	graphicsColor.o \
	pcSyncStack.o \
	pcSyncSection.o \
	pcSyncThreadSection.o \
	pcSyncProcessSection.o \
	pcProcessCollection.o \
	pcThreadCollection.o \
	pcJobCollection.o \
	pcSyncThreadStack.o \
	pcSyncProcessStack.o \
	pcSyncThreadDataSingle.o \
	pcSyncProcessDataSingle.o \
	pcSyncDataSingle.o \
	pcSyncThreadDataCollection.o \
	pcSyncProcessDataCollection.o \
	pcSyncDataCollection.o \
	cgi.o \
	cgiDialogue.o \
	cgiExchange.o \
	cgiServer.o \
	cgiBasicServer.o \
	cgiBasicExchange.o \
	cgiFastServer.o \
	cgiFastExchange.o

###########################################################

VPATH:=src/

all: @PACKAGE_NAME@

@PACKAGE_NAME@: $(OBJECTS)
	$(CXX) $(LDFLAGS) -shared -Wl,-soname,$@.so.@PACKAGE_VERSION@ -o $@.so.@PACKAGE_VERSION@ $(OBJECTS)
	ln -sf @PACKAGE_NAME@.so.@PACKAGE_VERSION@ $@.so
	
	@echo ""
	@echo ""
	@echo "Now you can run 'gmake install'."

.cc.o:
	$(CXX) $(DEFINES) $(CPPFLAGS) $(CFLAGS) -fPIC -c $^

install: @PACKAGE_NAME@ 
	${INSTALL} -m 755 -d ${DESTDIR}$(libdir)
	${INSTALL} -m 755 @PACKAGE_NAME@.so.@PACKAGE_VERSION@ ${DESTDIR}$(libdir)/

	${INSTALL} -m 755 -d ${DESTDIR}$(includedir)/libdodo
	${INSTALL} -m 755 include/libdodo/* ${DESTDIR}$(includedir)/libdodo/

	${INSTALL} -m 755 -d ${DESTDIR}$(bindir)
	${INSTALL} -m 755 bin/dodo-config ${DESTDIR}$(bindir)/
	
	$(LN_S) -f ${DESTDIR}$(libdir)/@PACKAGE_NAME@.so.@PACKAGE_VERSION@ ${DESTDIR}$(libdir)/@PACKAGE_NAME@.so
	
	@echo ""
	@echo ""
	@echo "Use libdodo with pleasure"
	@echo ""
	@echo ""

uninstall:
	rm -f ${DESTDIR}$(libdir)/@PACKAGE_NAME@.so.@PACKAGE_VERSION@
	rm -f ${DESTDIR}$(libdir)/@PACKAGE_NAME@.so
	rmdir ${DESTDIR}$(libdir)
	
	rm -rf ${DESTDIR}$(includedir)/libdodo
	rmdir ${DESTDIR}$(includedir)

	rm -f ${DESTDIR}$(bindir)/dodo-config
	rmdir ${DESTDIR}$(bindir)

	rmdir ${DESTDIR}$(prefix)
clean:
	rm -rf *.o *.so* *.a*

force : clean @PACKAGE_NAME@

prefix:=@prefix@
datarootdir:=@datarootdir@
exec_prefix:=@exec_prefix@
mandir:=@mandir@
libdir:=@libdir@
bindir:=@bindir@
includedir:=@includedir@

CXX:=@CXX@
INSTALL:=@INSTALL@
LN_S:=@LN_S@

CPPFLAGS:=-I./include @CPPFLAGS@
LDFLAGS:=-L./ @LDFLAGS@
CFLAGS:=@CFLAGS@ @DEFS@

###########################################################

OBJECTS:=dataBaseAccumulator.o \
	dataBaseConnector.o \
	dataBaseSqlConstructor.o \
	dataBasePostgresql.o \
	dataBaseMysql.o \
	dataBaseSqlite.o \
	dataFormatJsonProcessor.o \
	dataFormatJsonNode.o \
	dataFormatXmlProcessor.o \
	dataFormatXmlNode.o \
	dataTplProcessor.o \
	dataMemoryShared.o \
	toolsMisc.o \
	toolsCode.o \
	toolsFilesystem.o \
	toolsOs.o \
	toolsTime.o \
	toolsNetwork.o \
	toolsString.o \
	toolsLogger.o \
	toolsLibrary.o \
	toolsRegexp.o \
	types.o \
	xexec.o \
	exceptionBasic.o \
	ioChannel.o \
	ioFileFifo.o \
	ioFileRegular.o \
	ioFileTemp.o \
	ioEvent.o \
	ioEventInfo.o \
	ioStdio.o \
	ioPipe.o \
	ioSsl.o \
	ioNetworkHttp.o \
	ioNetworkConnection.o \
	ioNetworkSslExchange.o \
	ioNetworkSslServer.o \
	ioNetworkSslClient.o \
	ioNetworkExchange.o \
	ioNetworkServer.o \
	ioNetworkClient.o \
	ioMemory.o \
	rpcValue.o \
	rpcMethod.o \
	rpcResponse.o \
	rpcClient.o \
	rpcServer.o \
	rpcHttpClient.o \
	rpcCgiServer.o \
	rpcXmlClient.o \
	rpcXmlHttpClient.o \
	rpcXmlServer.o \
	rpcXmlCgiServer.o \
	rpcXmlValue.o \
	rpcXmlMethod.o \
	rpcXmlResponse.o \
	rpcJsonCgiServer.o \
	rpcJsonClient.o \
	rpcJsonHttpClient.o \
	rpcJsonMethod.o \
	rpcJsonResponse.o \
	rpcJsonServer.o \
	rpcJsonValue.o \
	graphicsTransform.o \
	graphicsImage.o \
	graphicsDraw.o \
	graphicsColor.o \
	pcSyncProtector.o \
	pcSyncSection.o \
	pcSyncThreadSection.o \
	pcSyncProcessSection.o \
	pcProcessCollection.o \
	pcThreadCollection.o \
	pcJobCollection.o \
	pcSyncThreadDataSingle.o \
	pcSyncProcessDataSingle.o \
	pcSyncDataSingle.o \
	pcSyncThreadDataCollection.o \
	pcSyncProcessDataCollection.o \
	pcSyncDataCollection.o \
	cgi.o \
	cgiDialogue.o \
	cgiExchange.o \
	cgiServer.o \
	cgiBasicServer.o \
	cgiBasicExchange.o \
	cgiFastServer.o \
	cgiFastExchange.o

###########################################################

VPATH:=src/

all: @PACKAGE_NAME@

@PACKAGE_NAME@: $(OBJECTS)
	@echo "-- Linking dodo"
	@$(CXX) $(LDFLAGS) -shared -Wl,-soname,$@.so.@SO_VERSION@ -o $@.so.@SO_VERSION@ $(OBJECTS)
	@rm -f $@.so
	@$(LN_S) @PACKAGE_NAME@.so.@SO_VERSION@ $@.so

	@echo ""
	@echo ""
	@echo "Now you can run 'gmake install'."

.cc.o:
	@echo "-- Compiling: $^"
	@$(CXX) $(CFLAGS) $(CPPFLAGS) -fPIC -c $^

install: @PACKAGE_NAME@
	@echo "" > install_manifest.txt

	@${INSTALL} -m 755 -d ${DESTDIR}$(libdir)
	@${INSTALL} -m 755 @PACKAGE_NAME@.so.@SO_VERSION@ ${DESTDIR}$(libdir)/
	@echo "-- Installing: ${DESTDIR}$(libdir)/@PACKAGE_NAME@.so.@SO_VERSION@"
	@echo ${DESTDIR}$(libdir)/@PACKAGE_NAME@.so.@SO_VERSION@ >> install_manifest.txt
	@${INSTALL} -m 755 @PACKAGE_NAME@.so ${DESTDIR}$(libdir)/
	@echo "-- Installing: ${DESTDIR}$(libdir)/@PACKAGE_NAME@.so"
	@echo ${DESTDIR}$(libdir)/@PACKAGE_NAME@.so >> install_manifest.txt

	@${INSTALL} -m 755 -d ${DESTDIR}$(includedir)/libdodo
	@for inc in include/libdodo/*;\
	do\
		echo "-- Installing: ${DESTDIR}$(includedir)/libdodo/$${inc#include/libdodo/}";\
		echo ${DESTDIR}$(includedir)/libdodo/$${inc#include/libdodo/} >> install_manifest.txt;\
		${INSTALL} -m 755 $$inc ${DESTDIR}$(includedir)/libdodo/;\
	done

	@${INSTALL} -m 755 -d ${DESTDIR}$(bindir)
	@${INSTALL} -m 755 bin/dodo-config ${DESTDIR}$(bindir)/
	@echo "-- Installing: ${DESTDIR}$(bindir)/dodo-config"
	@echo ${DESTDIR}$(bindir)/dodo-config >> install_manifest.txt

	@echo ""
	@echo ""
	@echo "Use libdodo with pleasure"
	@echo ""
	@echo ""

clean:
	@rm -rf *.o *.so* *.a*
